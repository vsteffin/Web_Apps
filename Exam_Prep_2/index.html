<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Planner</title>
	<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js"></script>  

    <style>
        /* --- CSS --- */
        body {
            font-family: sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f4f4;
        }

        .task-count-container {
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .container {
            width: 500px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-top: 0;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        #auth-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        #loginButton {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        #loginMessage {
            margin-top: 10px;
            color: #008000;
            font-size: 0.9rem;
        }


        .input-container {
            display: flex;
            margin-bottom: 15px;
        }

        input[type="text"], input[type="date"], input[type="file"] {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-right: 5px;
        }

        button {
            padding: 8px 15px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        li span {
            flex-grow: 1;
        }

        li button {
            margin-left: 10px;
        }

        li.completed span {
            text-decoration: line-through;
            color: grey;
        }

        .subtasks {
            margin-left: 20px;
        }

        .subtasks li {
            padding: 5px;
        }

        h2 {
            margin-top: 20px;
            margin-bottom: 10px;
        }

        #completedTaskList li span {
            text-decoration: line-through;
            color: grey;
        }

        #incompleteTaskList li span{
            color: #f59e0b;
        }
        #taskList li span{
            color: #ef4444;
        }

        #taskSections {
            display: flex;
            width: 100%;
            justify-content: space-between;
            margin-top: 20px;
        }

        #activeTasksSection,
        #completedTasksSection,
        #incompleteTasksSection {
            width: 30%;
        }
        /* --- End CSS --- */
    </style>
</head>
<body>
    <div class="task-count-container">
        <span id="completedCount">Completed: 0</span> |
        <span id="remainingCount">Remaining: 0</span>
    </div>
    <div class="container">
        <h1>Exam Planner</h1>
        <div id="auth-container">
            <button id="loginButton">Login/Signup</button>
            <p id="loginMessage"></p>
        </div>
        <div class="input-container" style="display: none;">
            <input type="text" id="taskInput" placeholder="Add a new task...">
            <input type="date" id="taskDate">
            <button id="addTaskButton">Add</button>
            <input type="file" id="excelUpload" accept=".xlsx, .xls">
        </div>
        <div id="taskSections">
            <div id="activeTasksSection">
                <ul id="taskList">
                    <h2>Active Tasks</h2>
                </ul>
            </div>
            <div id="completedTasksSection">
                <ul id="completedTaskList">
                    <h2>Completed Tasks</h2>
                </ul>
            </div>
            <div id="incompleteTasksSection">
                <ul id="incompleteTaskList">
                    <h2>Incomplete Tasks</h2>
                </ul>
            </div>
        </div>
    </div>
    <script>
import { initializeApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';
import 'firebase/firestore';
        /* --- JavaScript --- */
const firebaseConfig = {
  apiKey: "AIzaSyA-HNR_SkfHEYWYKOq684zBXYhlFUkM6BM",
  authDomain: "exam-prep-df9de.firebaseapp.com",
  projectId: "exam-prep-df9de",
  storageBucket: "exam-prep-df9de.firebasestorage.app",
  messagingSenderId: "409699118354",
  appId: "1:409699118354:web:517264bc5e406980f597cb"
};

const firebaseApp = initializeApp(firebaseConfig);
const auth = getAuth(firebaseApp);

document.addEventListener('DOMContentLoaded', () => {
    const taskInput = document.getElementById('taskInput');
    const taskDate = document.getElementById('taskDate');
    const addTaskButton = document.getElementById('addTaskButton');
    const taskList = document.getElementById('taskList');
    const completedTaskList = document.getElementById('completedTaskList');
    const incompleteTaskList = document.getElementById('incompleteTaskList');
    const excelUpload = document.getElementById('excelUpload');
    const completedCountDisplay = document.getElementById('completedCount');
    const remainingCountDisplay = document.getElementById('remainingCount');
    const loginButton = document.getElementById('loginButton');
    const loginMessage = document.getElementById('loginMessage');
    const inputContainer = document.querySelector('.input-container');
    const taskSections = document.getElementById('taskSections');
    const activeTasksSection = document.getElementById('activeTasksSection');
    const completedTasksSection = document.getElementById('completedTasksSection');
    const incompleteTasksSection = document.getElementById('incompleteTasksSection');


    let totalTasks = 0;
    let completedTasks = 0;
    let tasksByDate = {};
    let currentUser;

    function updateTaskCounts() {
        completedCountDisplay.textContent = `Completed: ${completedTasks}`;
        remainingCountDisplay.textContent = `Remaining: ${totalTasks - completedTasks}`;
    }

    function renderTasks() {
        taskList.innerHTML = '<h2>Active Tasks</h2>';
        completedTaskList.innerHTML = '<h2>Completed Tasks</h2>';
        incompleteTaskList.innerHTML = '<h2>Incomplete Tasks</h2>';
        Object.keys(tasksByDate).forEach((date) => {
            const dateHeader = document.createElement('li');
            dateHeader.innerHTML = `<strong>${date}</strong>`;
            if (tasksByDate[date].some(task => !task.isCompleted)) {
                taskList.appendChild(dateHeader);
            }
            tasksByDate[date].forEach((task) => {
                if (task.isCompleted) {
                    completedTaskList.appendChild(task.element);
                } else if (task.isNew || task.isInProgress) {
                    taskList.appendChild(task.element);
                } else {
                    incompleteTaskList.appendChild(task.element);
                }
            });
        });
        updateTaskCounts();
        if (currentUser) {
            saveTasks();
        }
    }

    function addTask(taskText, date, isSubtask = false, parentTask = null) {
        totalTasks++;
        const listItem = document.createElement('li');
        listItem.innerHTML = `
            <span style="${isSubtask ? 'margin-left: 20px;' : ''}">${taskText}</span>
            <button class="complete">${isSubtask ? '‚úÖ' : 'üòä'}</button>
            <button class="incomplete">${isSubtask ? '‚ùå' : 'üôÅ'}</button>
            <button class="inprogress">${isSubtask ? '‚ñ∂Ô∏è' : 'üòê'}</button>
            ${isSubtask ? '' : '<button class="subtask">Subtasks</button>'}
            <button class="delete">Delete</button>
            ${isSubtask ? '' : '<ul class="subtasks" style="display:none;"></ul>'}
        `;

        const taskObject = {
            text: taskText,
            date: date,
            element: listItem,
            isCompleted: false,
            isSubtask: isSubtask,
            parentTask: parentTask,
            isNew: true,
            isInProgress: false
        };

        if (!tasksByDate[date]) {
            tasksByDate[date] = [];
        }
        tasksByDate[date].push(taskObject);

        const completeButton = listItem.querySelector('.complete');
        const incompleteButton = listItem.querySelector('.incomplete');
        const inprogressButton = listItem.querySelector('.inprogress');
        const deleteButton = listItem.querySelector('.delete');
        const subtaskButton = listItem.querySelector('.subtask');
        const subtaskList = listItem.querySelector('.subtasks');

        completeButton.addEventListener('click', () => {
            taskObject.isCompleted = true;
            taskObject.isNew = false;
            taskObject.isInProgress = false;
            listItem.querySelector('span').classList.add('completed');
            listItem.querySelector('span').classList.remove('incomplete');
            listItem.querySelector('span').classList.remove('inprogress');
            completeButton.style.display = 'none';
            incompleteButton.style.display = 'block';
            inprogressButton.style.display = 'block';
            completedTasks++;
            renderTasks();
        });

        incompleteButton.addEventListener('click', () => {
            taskObject.isCompleted = false;
            taskObject.isNew = false;
            taskObject.isInProgress = false;
            listItem.querySelector('span').classList.remove('completed');
            listItem.querySelector('span').classList.add('incomplete');
            listItem.querySelector('span').classList.remove('inprogress');
            completeButton.style.display = 'block';
            incompleteButton.style.display = 'none';
            inprogressButton.style.display = 'block';
            if (completedTasks > 0) {
                completedTasks--;
            }
            renderTasks();
        });

        inprogressButton.addEventListener('click', () => {
            taskObject.isCompleted = false;
            taskObject.isNew = false;
            taskObject.isInProgress = true;
            listItem.querySelector('span').classList.remove('completed');
            listItem.querySelector('span').classList.remove('incomplete');
            listItem.querySelector('span').classList.add('inprogress');
            completeButton.style.display = 'block';
            incompleteButton.style.display = 'block';
            inprogressButton.style.display = 'none';
            if (completedTasks > 0) {
                completedTasks--;
            }
            renderTasks();
        });

        deleteButton.addEventListener('click', () => {
            if (taskObject.isCompleted) {
                completedTasks--;
            }
            totalTasks--;
            let taskDate = taskObject.date;
            tasksByDate[taskDate] = tasksByDate[taskDate].filter(task => task !== taskObject);
            if (tasksByDate[taskDate].length === 0) {
                delete tasksByDate[taskDate];
            }
            renderTasks();
        });

        if (subtaskButton) {
            subtaskButton.addEventListener('click', () => {
                if (subtaskList.style.display === 'none') {
                    subtaskList.style.display = 'block';
                    const subtaskInput = document.createElement('input');
                    subtaskInput.type = 'text';
                    const addSubtaskButton = document.createElement('button');
                    addSubtaskButton.textContent = 'Add Subtask';
                    listItem.appendChild(subtaskInput);
                    listItem.appendChild(addSubtaskButton);

                    addSubtaskButton.addEventListener('click', () => {
                        const subtaskText = subtaskInput.value.trim();
                        if (subtaskText) {
                            addTask(subtaskText, date, true, taskObject);
                            subtaskInput.value = '';
                        }
                    });
                } else {
                    subtaskList.style.display = 'none';
                    const subtaskInput = listItem.querySelector('input');
                    const addSubtaskButton = listItem.querySelector('button:last-of-type');
                    if (subtaskInput) {
                        subtaskInput.remove();
                    }
                    if (addSubtaskButton) {
                        addSubtaskButton.remove();
                    }
                }
            });
        }
        renderTasks();
    }

    excelUpload.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                jsonData.forEach((row) => {
                    if (row[0] && row[2]) {
                        let excelDate = row[0];
                        let jsDate;

                        if (typeof excelDate === 'number') {
                            jsDate = new Date((excelDate - 25569) * 86400 * 1000);
                        } else if (excelDate instanceof Date) {
                            jsDate = excelDate;
                        } else {
                            jsDate = new Date(excelDate);
                        }

                        if (isNaN(jsDate)) {
                            console.error("Invalid date:", excelDate);
                            return;
                        }
                        const formattedDate = jsDate.toISOString().slice(0, 10);
                        addTask(row[2], formattedDate);
                    }
                });
                renderTasks();
            };
            reader.readAsArrayBuffer(file);
        }
    });

    function loadTasks(userId) {
        const tasksRef = database.ref(`users/${userId}/tasks`);
        tasksRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                tasksByDate = data;
                for (const date in tasksByDate) {
                    tasksByDate[date].forEach(task => {
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `
                            <span style="${task.isSubtask ? 'margin-left: 20px;' : ''}">${task.text}</span>
                            <button class="complete">${task.isSubtask ? '‚úÖ' : 'üòä'}</button>
                            <button class="incomplete">${task.isSubtask ? '‚ùå' : 'üôÅ'}</button>
                            <button class="inprogress">${task.isSubtask ? '‚ñ∂Ô∏è' : 'üòê'}</button>
                            ${task.isSubtask ? '' : '<button class="subtask">Subtasks</button>'}
                            <button class="delete">Delete</button>
                            ${task.isSubtask ? '' : '<ul class="subtasks" style="display:none;"></ul>'}
                        `;
                        task.element = listItem;

                        const completeButton = listItem.querySelector('.complete');
                        const incompleteButton = listItem.querySelector('.incomplete');
                        const inprogressButton = listItem.querySelector('.inprogress');
                        const deleteButton = listItem.querySelector('.delete');
                        const subtaskButton = listItem.querySelector('.subtask');
                        const subtaskList = listItem.querySelector('.subtasks');

                        completeButton.addEventListener('click', () => {
                            task.isCompleted = true;
                            task.isNew = false;
                            task.isInProgress = false;
                            listItem.querySelector('span').classList.add('completed');
                            listItem.querySelector('span').classList.remove('incomplete');
                            listItem.querySelector('span').classList.remove('inprogress');
                            completeButton.style.display = 'none';
                            incompleteButton.style.display = 'block';
                            inprogressButton.style.display = 'block';
                            completedTasks++;
                            renderTasks();
                        });

                        incompleteButton.addEventListener('click', () => {
                            task.isCompleted = false;
                            task.isNew = false;
                            task.isInProgress = false;
                            listItem.querySelector('span').classList.remove('completed');
                            listItem.querySelector('span').classList.add('incomplete');
                            listItem.querySelector('span').classList.remove('inprogress');
                            completeButton.style.display = 'block';
                            incompleteButton.style.display = 'none';
                            inprogressButton.style.display = 'block';
                            if (completedTasks > 0) {
                                completedTasks--;
                            }
                            renderTasks();
                        });

                        inprogressButton.addEventListener('click', () => {
                            task.isCompleted = false;
                            task.isNew = false;
                            task.isInProgress = true;
                            listItem.querySelector('span').classList.remove('completed');
                            listItem.querySelector('span').classList.remove('incomplete');
                            listItem.querySelector('span').classList.add('inprogress');
                            completeButton.style.display = 'block';
                            incompleteButton.style.display = 'block';
                            inprogressButton.style.display = 'none';
                            if (completedTasks > 0) {
                                completedTasks--;
                            }
                            renderTasks();
                        });

                        deleteButton.addEventListener('click', () => {
                            if (task.isCompleted) {
                                completedTasks--;
                            }
                            totalTasks--;
                            let taskDate = task.date;
                            tasksByDate[taskDate] = tasksByDate[taskDate].filter(task => task !== taskObject);
                            if (tasksByDate[taskDate].length === 0) {
                                delete tasksByDate[taskDate];
                            }
                            renderTasks();
                        });

                        if (subtaskButton) {
                            subtaskButton.addEventListener('click', () => {
                                if (subtaskList.style.display === 'none') {
                                    subtaskList.style.display = 'block';
                                    const subtaskInput = document.createElement('input');
                                    subtaskInput.type = 'text';
                                    const addSubtaskButton = document.createElement('button');
                                    addSubtaskButton.textContent = 'Add Subtask';
                                    listItem.appendChild(subtaskInput);
                                    listItem.appendChild(addSubtaskButton);

                                    addSubtaskButton.addEventListener('click', () => {
                                        const subtaskText = subtaskInput.value.trim();
                                        if (subtaskText) {
                                            addTask(subtaskText, date, true, taskObject);
                                            subtaskInput.value = '';
                                        }
                                    });
                                } else {
                                    subtaskList.style.display = 'none';
                                    const subtaskInput = listItem.querySelector('input');
                                    const addSubtaskButton = listItem.querySelector('button:last-of-type');
                                    if (subtaskInput) {
                                        subtaskInput.remove();
                                    }
                                    if (addSubtaskButton) {
                                        addSubtaskButton.remove();
                                    }
                                }
                            });
                        }
                    });
                }
                renderTasks();
            }
        });
    }

    function saveTasks() {
        if (currentUser) {
            const tasksRef = database.ref(`users/${currentUser.uid}/tasks`);
            tasksRef.set(tasksByDate);
        }
    }

    loginButton.addEventListener('click', () => {
        if (currentUser) {
            auth.signOut().then(() => {
                currentUser = null;
                loginButton.textContent = 'Login/Signup';
                loginMessage.textContent = 'Logged out.';
                inputContainer.style.display = 'none';
                taskList.innerHTML = '';
                completedTaskList.innerHTML = '';
                incompleteTaskList.innerHTML = '';
                tasksByDate = {};
                totalTasks = 0;
                completedTasks = 0;
                updateTaskCounts();
            }).catch(error => {
                loginMessage.textContent = `Error logging out: ${error.message}`;
            });
        } else {
            auth.signInAnonymously().then(result => {
                currentUser = result.user;
                loginButton.textContent = 'Logout';
                loginMessage.textContent = 'Logged in successfully!';
                inputContainer.style.display = 'flex';
                loadTasks(currentUser.uid);
            }).catch(error => {
                loginMessage.textContent = `Error logging in: ${error.message}`;
            });
        }
    });

    auth.onAuthStateChanged(user => {
        if (user) {
            currentUser = user;
            loginButton.textContent = 'Logout';
            loginMessage.textContent = 'Logged in successfully!';
            inputContainer.style.display = 'flex';
            loadTasks(currentUser.uid);
        } else {
            currentUser = null;
            loginButton.textContent = 'Login/Signup';
            loginMessage.textContent = '';
            inputContainer.style.display = 'none';
            taskList.innerHTML = '';
            completedTaskList.innerHTML = '';
            incompleteTaskList.innerHTML = '';
            tasksByDate = {};
            totalTasks = 0;
            completedTasks = 0;
            updateTaskCounts();
        }
    });

    addTaskButton.addEventListener('click', () => {
        const taskText = taskInput.value.trim();
        const date = taskDate.value;
        if (taskText) {
            addTask(taskText, date);
            taskInput.value = '';
            taskDate.value = '';
        }
    });

    function loadInitialTasks() {
      auth.onAuthStateChanged(user => {
        if (user) {
          currentUser = user;
          loadTasks(currentUser.uid);
        }
      });
    }
    loadInitialTasks();
});
/* --- End JavaScript --- */
</script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js"></script>
</body>
</html>